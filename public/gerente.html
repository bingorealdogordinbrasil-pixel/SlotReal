<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerência SlotReal</title>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; text-align: center; }
        .card { background: #111; border: 1px solid #d4af37; margin: 10px; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
        .saque-card { background: #111; border: 1px solid #2ecc71; margin: 10px; padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; }
        button { background: #d4af37; border: none; padding: 10px; border-radius: 5px; font-weight: bold; cursor:pointer; }
        .btn-pago { background: #2ecc71; color: #000; }
        input { padding: 10px; border-radius: 5px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Painel do Gerente</h1>
    
    <div id="info-lucro" style="margin-bottom: 20px; font-weight: bold; color: #d4af37;">
        LUCRO TOTAL: R$ <span id="val-lucro">0.00</span>
    </div>

    <div id="login-admin">
        <input type="password" id="pass-admin" placeholder="Senha do Gerente">
        <button onclick="carregar()">ACESSAR PAINEL</button>
    </div>

    <div id="painel" style="display:none">
        <h3>SOLICITAÇÕES DE SAQUE</h3>
        <div id="lista-saques"></div>
        <hr>
        <h3>LISTA DE USUÁRIOS</h3>
        <div id="lista-usuarios"></div>
    </div>

    <script>
        let senhaGlobal = "";
        async function carregar() {
            senhaGlobal = document.getElementById('pass-admin').value;
            const res = await fetch('/api/admin/list', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ senha: senhaGlobal })
            });
            const d = await res.json();
            if(d.success) {
                document.getElementById('login-admin').style.display = 'none';
                document.getElementById('painel').style.display = 'block';
                document.getElementById('val-lucro').innerText = d.lucroBanca.toFixed(2);

                // LISTA DE SAQUES
                const listaSaques = document.getElementById('lista-saques');
                listaSaques.innerHTML = d.saques.length === 0 ? "<p>Nenhum saque pendente</p>" : "";
                d.saques.forEach(s => {
                    listaSaques.innerHTML += `
                        <div class="saque-card">
                            <div style="text-align:left">
                                <b>Usuário: ${s.user}</b><br>
                                <span style="color:#2ecc71">Valor: R$ ${s.valor.toFixed(2)}</span><br>
                                <small>PIX: ${s.pix}</small>
                            </div>
                            <button class="btn-pago" onclick="confirmarPagamento('${s._id}')">JÁ PAGUEI</button>
                        </div>`;
                });

                // LISTA DE USUÁRIOS
                const list = document.getElementById('lista-usuarios');
                list.innerHTML = "";
                d.users.forEach(u => {
                    list.innerHTML += `
                        <div class="card">
                            <div><b>${u.user}</b><br>Saldo: R$ ${u.saldo.toFixed(2)}</div>
                            <div>
                                <input type="number" id="v-${u.user}" value="10" style="width:50px">
                                <button onclick="addBonus('${u.user}')">BÔNUS</button>
                            </div>
                        </div>`;
                });
            } else { alert("Senha errada!"); }
        }

        async function confirmarPagamento(id) {
            if(!confirm("Você já fez o PIX para o cliente?")) return;
            await fetch('/api/admin/pagar-saque', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ senha: senhaGlobal, id: id })
            });
            carregar();
        }

        async function addBonus(user) {
            const v = document.getElementById(`v-${user}`).value;
            await fetch('/api/admin/bonus', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ senha: senhaGlobal, user: user, valor: parseFloat(v) })
            });
            carregar();
        }
    </script>
</body>
</html>
