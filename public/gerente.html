<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel do Dono - SlotReal</title>
    <style>
        :root { --gold: #d4af37; --bg: #000; --card: #111; --green: #2ecc71; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; margin: 0; padding: 20px; text-align: center; }
        
        .stats-container { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-bottom: 30px; }
        .stat-card { background: var(--card); border: 1px solid var(--gold); padding: 15px; border-radius: 10px; min-width: 180px; }
        .stat-card h3 { margin: 0; font-size: 12px; color: #888; text-transform: uppercase; }
        .stat-card p { margin: 10px 0 0; font-size: 22px; font-weight: bold; }

        .user-list { max-width: 600px; margin: 0 auto; }
        .user-card { background: var(--card); border: 1px solid #333; padding: 15px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        
        input { background: #000; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 8px; width: 70px; text-align: center; }
        button { cursor: pointer; border: none; border-radius: 8px; padding: 10px 15px; font-weight: bold; background: var(--gold); color: #000; }
        .btn-refresh { width: 100%; max-width: 600px; margin-bottom: 20px; font-size: 16px; }

        #login-area { margin-top: 100px; }
    </style>
</head>
<body>

    <div id="login-area">
        <h1 style="color:var(--gold)">PAINEL DE CONTROLE</h1>
        <input type="password" id="pass-admin" placeholder="Sua Senha Mestra" style="width: 200px;">
        <br><br>
        <button onclick="carregar()">ACESSAR GERENTE</button>
    </div>

    <div id="painel" style="display:none">
        <div class="stats-container">
            <div class="stat-card" style="border-left: 5px solid var(--green);">
                <h3>ðŸ’° MEU LUCRO (REAL)</h3>
                <p id="lucro-banca" style="color: var(--green);">R$ 0,00</p>
            </div>
            <div class="stat-card">
                <h3>ðŸ‘¥ JOGADORES</h3>
                <p id="total-users">0</p>
            </div>
            <div class="stat-card" style="border-left: 5px solid #e74c3c;">
                <h3>Saldo dos Clientes</h3>
                <p id="total-saldo" style="color: #e74c3c;">R$ 0,00</p>
            </div>
        </div>

        <button class="btn-refresh" onclick="carregar()">ðŸ”„ ATUALIZAR LISTA</button>

        <div id="lista" class="user-list"></div>
    </div>

    <script>
        let senhaMestra = "";

        async function carregar() {
            senhaMestra = document.getElementById('pass-admin').value;
            
            try {
                const res = await fetch('/api/admin/list', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ senha: senhaMestra })
                });
                const d = await res.json();

                if(d.success) {
                    document.getElementById('login-area').style.display = 'none';
                    document.getElementById('painel').style.display = 'block';
                    
                    // Atualiza os Totais
                    document.getElementById('lucro-banca').innerText = `R$ ${d.lucroBanca.toFixed(2)}`;
                    document.getElementById('total-users').innerText = d.users.length;

                    let somaSaldo = 0;
                    const listArea = document.getElementById('lista');
                    listArea.innerHTML = "";

                    d.users.forEach(u => {
                        somaSaldo += u.saldo;
                        listArea.innerHTML += `
                            <div class="user-card">
                                <div style="text-align: left;">
                                    <b>${u.user}</b><br>
                                    <small style="color:var(--green)">R$ ${u.saldo.toFixed(2)}</small>
                                </div>
                                <div>
                                    <input type="number" id="v-${u.user}" value="10">
                                    <button onclick="darBonus('${u.user}')">DAR BÃ”NUS</button>
                                </div>
                            </div>
                        `;
                    });

                    document.getElementById('total-saldo').innerText = `R$ ${somaSaldo.toFixed(2)}`;
                } else {
                    alert("Senha errada, pai!");
                }
            } catch (e) {
                alert("Erro ao conectar com o servidor.");
            }
        }

        async function darBonus(user) {
            const valor = document.getElementById(`v-${user}`).value;
            const res = await fetch('/api/admin/bonus', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ 
                    senha: senhaMestra, 
                    user: user, 
                    valor: parseFloat(valor) 
                })
            });

            if(res.ok) {
                alert("BÃ´nus enviado com sucesso!");
                carregar(); // Atualiza a lista automaticamente
            }
        }
    </script>
</body>
</html>
