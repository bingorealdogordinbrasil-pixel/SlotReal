<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Painel Gerente - SlotReal</title>
    <style>
        body { background: #0b0f0b; color: #fff; font-family: sans-serif; padding: 20px; }
        .card { background: #111; border: 1px solid #d4af37; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #333; padding: 12px; text-align: left; }
        th { background: #d4af37; color: #000; }
        input { padding: 5px; width: 80px; background: #222; color: #fff; border: 1px solid #d4af37; }
        .btn-save { background: #2ecc71; border: none; padding: 5px 10px; cursor: pointer; border-radius: 4px; }
        .stats-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
        .stat-box { background: #1a1a1a; padding: 15px; border-radius: 8px; border-left: 4px solid #d4af37; }
    </style>
</head>
<body>
    <h1>ðŸ‘‘ PAINEL DO GERENTE</h1>

    <div class="stats-grid">
        <div class="stat-box">UsuÃ¡rios: <b id="stat-users">-</b></div>
        <div class="stat-box">Saldo em Conta: <b id="stat-saldos">R$ 0</b></div>
        <div class="stat-box">Lucro Total: <b id="stat-lucro">R$ 0</b></div>
    </div>

    <div class="card">
        <h3>Lista de Jogadores</h3>
        <table>
            <thead>
                <tr>
                    <th>UsuÃ¡rio</th>
                    <th>Email</th>
                    <th>Saldo Atual</th>
                    <th>Total Ganho</th>
                    <th>AÃ§Ã£o</th>
                </tr>
            </thead>
            <tbody id="user-table"></tbody>
        </table>
    </div>

    <script>
        async function carregarDados() {
            // Stats
            const sRes = await fetch('/api/admin/stats');
            const sData = await sRes.json();
            document.getElementById('stat-users').innerText = sData.totalUsers;
            document.getElementById('stat-saldos').innerText = `R$ ${sData.totalSaldos.toFixed(2)}`;
            document.getElementById('stat-lucro').innerText = `R$ ${sData.totalGanhos.toFixed(2)}`;

            // Tabela
            const uRes = await fetch('/api/admin/users');
            const users = await uRes.json();
            const tbody = document.getElementById('user-table');
            tbody.innerHTML = '';

            users.forEach(u => {
                tbody.innerHTML += `
                    <tr>
                        <td>${u.user}</td>
                        <td>${u.email || '-'}</td>
                        <td><input type="number" id="saldo-${u.user}" value="${u.saldo.toFixed(2)}"></td>
                        <td>R$ ${u.ganhos.toFixed(2)}</td>
                        <td><button class="btn-save" onclick="salvar('${u.user}')">ATUALIZAR</button></td>
                    </tr>
                `;
            });
        }

        async function salvar(username) {
            const novoSaldo = document.getElementById(`saldo-${username}`).value;
            const res = await fetch('/api/admin/edit-saldo', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ user: username, novoSaldo })
            });
            if(res.ok) {
                alert('Saldo atualizado!');
                carregarDados();
            }
        }

        carregarDados();
    </script>
</body>
</html>
