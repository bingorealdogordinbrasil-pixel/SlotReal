<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SlotReal Gold - Premium Betting</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --gold: #d4af37; --gold-dark: #a68a2d; --bg: #0b0b0b; --card: #161616; }
        body { background: var(--bg); color: #fff; font-family: 'Poppins', sans-serif; margin: 0; text-align: center; }
        
        /* HEADER PROFISSIONAL */
        .top-bar { background: rgba(17,17,17,0.95); padding: 12px 20px; display: flex; justify-content: space-between; border-bottom: 2px solid var(--gold); position: sticky; top: 0; z-index: 100; backdrop-filter: blur(10px); }
        .balance-box { background: #000; border: 1px solid var(--gold); padding: 5px 15px; border-radius: 50px; display: flex; align-items: center; gap: 8px; }
        
        /* BOTÃ•ES ESTILIZADOS */
        .btn-gold { background: linear-gradient(180deg, var(--gold) 0%, var(--gold-dark) 100%); border: none; padding: 10px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; color: #000; transition: transform 0.2s; }
        .btn-gold:active { transform: scale(0.95); }
        .btn-outline { background: transparent; border: 1px solid #444; color: #fff; padding: 8px 15px; border-radius: 8px; cursor: pointer; }

        /* ROLETA DESIGN */
        .roleta-container { position: relative; width: 90%; max-width: 360px; margin: 25px auto; overflow: hidden; background: #000; border: 3px solid var(--gold); border-radius: 20px; height: 90px; box-shadow: 0 0 30px rgba(212,175,55,0.2); }
        .cell { min-width: 70px; height: 70px; margin: 0 10px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-weight: 800; color: #000; font-size: 14px; box-shadow: inset 0 0 10px rgba(0,0,0,0.3); }
        .seletor { position: absolute; top: 0; left: 50%; transform: translateX(-50%); width: 4px; height: 100%; background: #fff; z-index: 10; box-shadow: 0 0 20px #fff; }

        /* AREA DE APOSTAS */
        .bet-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; padding: 20px; }
        .bet-card { background: var(--card); border-radius: 12px; padding: 10px 5px; border: 1px solid #222; border-bottom: 4px solid transparent; cursor: pointer; }
        .bet-card span { font-size: 10px; color: #888; text-transform: uppercase; }
        .bet-card b { display: block; color: var(--gold); font-size: 16px; margin-top: 5px; }

        /* AUTH BOX */
        .auth-container { margin-top: 80px; background: var(--card); padding: 30px; border-radius: 25px; border: 1px solid var(--gold); display: inline-block; width: 300px; box-shadow: 0 10px 50px rgba(0,0,0,0.5); }
        input { width: 90%; padding: 14px; margin: 10px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 10px; outline: none; transition: border 0.3s; }
        input:focus { border-color: var(--gold); }

        /* NOTIFICAÃ‡ÃƒO TOAST */
        #toast { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #fff; color: #000; padding: 12px 25px; border-radius: 50px; font-weight: 700; z-index: 1000; display: none; animation: slideUp 0.3s; }
        @keyframes slideUp { from { bottom: -50px; } to { bottom: 20px; } }

        /* MODAIS */
        .modal { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--card); padding: 30px; border-radius: 25px; width: 300px; z-index: 200; border: 1px solid var(--gold); text-align: center; }
        .overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 150; backdrop-filter: blur(5px); }
    </style>
</head>
<body>
    <div id="toast"></div>
    <div class="overlay" id="overlay"></div>

    <div id="auth-screen">
        <div class="auth-container">
            <h2 style="margin:0; color: var(--gold)">SLOTREAL</h2>
            <p style="font-size:12px; color:#666">PREMIUM GAMING</p>
            <div id="login-form">
                <input type="text" id="u" placeholder="Nome de usuÃ¡rio">
                <input type="password" id="p" placeholder="Senha secreta">
                <button class="btn-gold" style="width:100%; margin-top:10px" onclick="handleLogin()">ENTRAR NA CONTA</button>
                <p onclick="showReg(true)" style="font-size:13px; margin-top:15px; cursor:pointer">NÃ£o tem conta? <span style="color:var(--gold)">Cadastre-se</span></p>
            </div>
            <div id="reg-form" style="display:none">
                <input type="text" id="ru" placeholder="Escolha um usuÃ¡rio">
                <input type="password" id="rp" placeholder="Crie uma senha">
                <button class="btn-gold" style="width:100%; margin-top:10px" onclick="handleReg()">FINALIZAR CADASTRO</button>
                <p onclick="showReg(false)" style="font-size:13px; margin-top:15px; cursor:pointer">JÃ¡ Ã© membro? <span style="color:var(--gold)">Fazer Login</span></p>
            </div>
        </div>
    </div>

    <div id="game-screen" style="display:none">
        <div class="top-bar">
            <div class="balance-box">
                <span style="color:var(--gold)">ðŸ’°</span> <b id="balance">0.00</b>
            </div>
            <div style="display:flex; gap:8px">
                <button class="btn-gold" onclick="openModal('pix-modal')">PIX</button>
                <button class="btn-outline" onclick="openModal('saque-modal')">SAQUE</button>
            </div>
        </div>

        <div style="margin-top:20px">
            <span id="status-label" style="font-size:12px; color:#888; text-transform:uppercase">PrÃ³xima Rodada em</span>
            <h1 id="timer" style="margin:0; font-size:50px; color:var(--gold)">00:30</h1>
        </div>

        <div class="roleta-container">
            <div class="seletor"></div>
            <div id="grid" style="display:flex; align-items:center; position:absolute; transition: transform 6s cubic-bezier(0.1, 0, 0.1, 1)"></div>
        </div>

        <div class="bet-grid" id="bet-grid"></div>
    </div>

    <div class="modal" id="pix-modal">
        <h3 style="color:var(--gold)">DEPOSITAR VIA PIX</h3>
        <input type="number" id="v-pix" value="20" min="10">
        <button class="btn-gold" style="width:100%" onclick="getPix()">GERAR QR CODE</button>
        <div id="qr-area" style="display:none; margin-top:15px">
            <img id="qr-img" style="width:160px; background:#fff; padding:10px; border-radius:10px">
            <button class="btn-outline" style="width:100%; margin-top:10px; font-size:12px" onclick="copyCode()">COPIAR CÃ“DIGO PIX</button>
        </div>
        <button class="btn-outline" style="width:100%; margin-top:10px" onclick="closeModals()">FECHAR</button>
    </div>

    <div class="modal" id="win-modal">
        <h2 id="win-title" style="margin:0">RESULTADO</h2>
        <h1 id="win-value" style="color:var(--gold); font-size:40px">R$ 0.00</h1>
        <button class="btn-gold" style="width:100%" onclick="closeModals()">CONTINUAR JOGANDO</button>
    </div>

<script>
    let state = { u:'', s:0, b:[0,0,0,0,0,0,0,0,0,0] }, pos = 0, isSpinning = false;
    const CORES = ['#FFF','#444','#FF0','#0F0','#F0F','#F00','#00F','#888','#840','#0FF'];

    function toast(m) {
        const t = document.getElementById('toast');
        t.innerText = m; t.style.display = 'block';
        setTimeout(() => t.style.display = 'none', 3000);
    }

    function showReg(v) {
        document.getElementById('login-form').style.display = v ? 'none' : 'block';
        document.getElementById('reg-form').style.display = v ? 'block' : 'none';
    }

    async function handleReg() {
        const res = await fetch('/auth/register',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user:document.getElementById('ru').value,pass:document.getElementById('rp').value})});
        const d = await res.json();
        toast(d.msg); if(d.success) showReg(false);
    }

    async function handleLogin() {
        const res = await fetch('/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user:document.getElementById('u').value,pass:document.getElementById('p').value})});
        const d = await res.json();
        if(d.success) { state.u = d.user; state.s = d.saldo; initGame(); } else toast(d.msg);
    }

    function initGame() {
        document.getElementById('auth-screen').style.display='none';
        document.getElementById('game-screen').style.display='block';
        const g = document.getElementById('grid');
        for(let i=0;i<1000;i++){
            const c = document.createElement('div'); c.className='cell';
            c.style.background = CORES[i%10]; c.innerText = 'R$ 5'; g.appendChild(c);
        }
        const area = document.getElementById('bet-grid');
        CORES.forEach((c,i) => {
            const d = document.createElement('div'); d.className='bet-card';
            d.style.borderBottomColor = c;
            d.innerHTML = `<span>COR ${i}</span><b id="vb-${i}">R$ 0</b>`;
            d.onclick = () => placeBet(i);
            area.appendChild(d);
        });
        updateUI(); setInterval(sync, 1000);
    }

    function placeBet(i) {
        if(state.s < 1 || isSpinning) return toast("Saldo insuficiente ou rodada em curso!");
        state.b[i]++; state.s--; updateUI();
        fetch('/api/save-saldo',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user:state.u,saldo:state.s,bets:state.b})});
    }

    async function sync() {
        const d = await (await fetch('/api/tempo-real')).json();
        document.getElementById('timer').innerText = `00:${d.segundos.toString().padStart(2,'0')}`;
        if(d.segundos === 30 && !isSpinning) startSpin();
    }

    async function startSpin() {
        isSpinning = true;
        const d = await (await fetch('/api/spin',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user:state.u})})).json();
        const g = document.getElementById('grid');
        let currentIdx = Math.round(pos/90)%10, diff = d.corAlvo - currentIdx;
        if(diff <= 0) diff += 10;
        pos += (60 + diff) * 90;
        g.style.transform = `translateX(-${pos - 135}px)`;
        
        setTimeout(() => {
            document.getElementById('win-title').innerText = d.valorGanho > 0 ? "VOCÃŠ GANHOU!" : "NÃƒO FOI DESSA VEZ";
            document.getElementById('win-value').innerText = `R$ ${d.valorGanho.toFixed(2)}`;
            openModal('win-modal');
            state.s = d.novoSaldo; state.b.fill(0); updateUI();
            isSpinning = false;
        }, 6500);
    }

    function updateUI() {
        document.getElementById('balance').innerText = state.s.toFixed(2);
        state.b.forEach((v,i) => document.getElementById(`vb-${i}`).innerText = `R$ ${v}`);
    }

    function openModal(id) { document.getElementById(id).style.display='block'; document.getElementById('overlay').style.display='block'; }
    function closeModals() { document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); document.getElementById('overlay').style.display='none'; }

    async function getPix() {
        const res = await fetch('/gerar-pix',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({user:state.u,valor:document.getElementById('v-pix').value})});
        const d = await res.json();
        if(d.success) {
            document.getElementById('qr-img').src = `data:image/jpeg;base64,${d.qr}`;
            document.getElementById('qr-area').setAttribute('data-c', d.code);
            document.getElementById('qr-area').style.display='block';
        }
    }
    function copyCode() { navigator.clipboard.writeText(document.getElementById('qr-area').getAttribute('data-c')); toast("Copiado!"); }
</script>
</body>
</html>
